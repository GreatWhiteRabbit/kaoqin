{"ast":null,"code":"import \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.split.js\";\nimport \"core-js/modules/es.function.name.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nexport default {\n  data: function data() {\n    return {\n      page: [],\n      state: ' ',\n      isHere: false,\n      startTime: '',\n      endTime: '',\n      dataState: ''\n    };\n  },\n  created: function created() {\n    this.loaddata();\n    this.loadstate();\n    this.getWorkTime();\n  },\n  methods: {\n    loaddata: function loaddata() {\n      var _this = this;\n\n      var account = window.sessionStorage.getItem('account');\n      this.$http.get('/queryRecordsByActOrType?account=' + account).then(function (res) {\n        _this.page = res.data;\n      });\n    },\n    loadstate: function loadstate() {\n      var _this2 = this;\n\n      var empId = window.sessionStorage.getItem('empId');\n      this.$http.get('/queryEmpStateById/' + empId).then(function (res) {\n        if (res.data == 0) {\n          _this2.state = '下班';\n          _this2.isHere = false;\n        } else if (res.data == 1) {\n          _this2.state = '在班';\n          _this2.isHere = true;\n        } else if (res.data == 2) {\n          _this2.state = '外出';\n          _this2.isHere = false;\n        } else if (res.data == 3) {\n          _this2.state = '假期';\n          _this2.isHere = false;\n        } else if (res.data == 4) {\n          _this2.state = '请假';\n          _this2.isHere = false;\n        }\n      });\n    },\n    getWorkTime: function getWorkTime() {\n      var _this3 = this;\n\n      this.$http.get(\"/time/getWorkTime\").then(function (res) {\n        _this3.startTime = res.data[0].starttime;\n        _this3.endTime = res.data[0].endtime;\n      });\n    },\n    formatType: function formatType(row) {\n      if (row.type == 0) {\n        return '上班打卡';\n      } else if (row.type == 1) {\n        return '下班打卡';\n      } else if (row.type == 2) {\n        return '外出打卡';\n      } else if (row.type == 3) {\n        return '返回打卡';\n      }\n    },\n    formatDate: function formatDate(row) {\n      var date = new Date(row.time);\n      var year = date.getFullYear();\n      var month = date.getMonth() + 1;\n      var day = date.getDate();\n      var hour = date.getHours();\n      hour = hour < 10 ? \"0\" + hour : hour;\n      var minute = date.getMinutes();\n      minute = minute < 10 ? \"0\" + minute : minute;\n      var second = date.getSeconds();\n      second = second < 10 ? \"0\" + second : second;\n      return year + '-' + month + '-' + day + ' ' + hour + ':' + minute + ':' + second;\n    },\n    changeState: function changeState(num) {\n      var _this4 = this;\n\n      var hour1 = parseInt(this.startTime.split(':')[0]);\n      var mimute1 = parseInt(this.startTime.split(':')[1]);\n      var hour2 = parseInt(this.endTime.split(':')[0]);\n      var mimute2 = parseInt(this.endTime.split(':')[1]);\n      var date = new Date();\n      var y = date.getFullYear();\n      var m = date.getMonth();\n      var d = date.getDate();\n      var h = date.getHours();\n      var miu = date.getMinutes();\n      var time = y + '-' + m + '-' + d + '  ' + h + ':' + miu;\n      var worktime = this.startTime + '-' + this.endTime;\n      var hour = parseInt(date.getHours());\n      var minute = parseInt(date.getMinutes());\n\n      if (num === 0) {\n        if (hour * 60 + minute > hour1 * 60 + mimute1) {\n          this.dataState = '迟到';\n        } else {\n          this.dataState = '正常';\n        }\n      } else if (num === 1) {\n        if (hour * 60 + minute > hour2 * 60 + mimute2 + 60) {\n          this.dataState = '加班';\n        } else if (hour * 60 + minute < hour2 * 60 + mimute2 - 60) {\n          this.dataState = '早退';\n        } else {\n          this.dataState = '正常';\n        }\n      }\n\n      this.$http.post('/dakaState/addDakaState', {\n        username: this.page[0].name,\n        count: window.sessionStorage.getItem('account'),\n        time: time,\n        state: this.dataState,\n        worktime: worktime\n      });\n      var empId = window.sessionStorage.getItem('empId');\n      this.$http.post('/checkInOrOut/' + empId + '/' + num).then(function (res) {\n        if (res.data) {\n          _this4.$message({\n            message: '操作成功',\n            type: 'success'\n          });\n\n          _this4.loaddata();\n\n          _this4.loadstate();\n\n          if (num == 0) {\n            _this4.isHere = true;\n          } else if (num == 1) {\n            _this4.isHere = false;\n          } else if (num == 2) {\n            _this4.isHere = false;\n          } else if (num == 3) {\n            _this4.isHere = true;\n          }\n        } else {\n          _this4.$message({\n            message: '操作失败',\n            type: 'error'\n          });\n        }\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuDA;AACAA,MADA,kBACA;AACA;AACAC,cADA;AAEAC,gBAFA;AAGAC,mBAHA;AAIAC,mBAJA;AAKAC,iBALA;AAMAC;AANA;AAQA,GAVA;AAWAC,SAXA,qBAWA;AACA;AACA;AACA;AACA,GAfA;AAgBAC;AACAC,YADA,sBACA;AAAA;;AACA;AACA;AACA;AACA,OAFA;AAGA,KANA;AAOAC,aAPA,uBAOA;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA,SAHA,MAGA;AACA;AACA;AACA,SAHA,MAGA;AACA;AACA;AACA,SAHA,MAGA;AACA;AACA;AACA,SAHA,MAGA;AACA;AACA;AACA;AACA,OAjBA;AAkBA,KA3BA;AA4BAC,eA5BA,yBA4BA;AAAA;;AACA;AACA;AACA;AACA,OAHA;AAIA,KAjCA;AAkCAC,cAlCA,sBAkCAC,GAlCA,EAkCA;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA,OAFA,MAEA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA,KA5CA;AA6CAC,cA7CA,sBA6CAD,GA7CA,EA6CA;AACA;AACA;AACA;AACA;AACA;AACAE;AACA;AACAC;AACA;AACAC;AACA;AACA,KAzDA;AA0DAC,eA1DA,uBA0DAC,GA1DA,EA0DA;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA,SAFA,MAGA;AACA;AACA;AACA,OAPA,MAQA;AACA;AACA;AACA,SAFA,MAGA;AACA;AACA,SAFA,MAGA;AACA;AACA;AACA;;AACA;AACAC,mCADA;AAEAC,uDAFA;AAGAC,kBAHA;AAIApB,6BAJA;AAKAqB;AALA;AAOA;AACA;AACA;AACA;AACAC,2BADA;AAEAC;AAFA;;AAIA;;AACA;;AACA;AACA;AAAA,WADA,MAEA;AACA;AAAA,WADA,MAEA;AACA;AAAA,WADA,MAEA;AACA;AAAA;AACA,SAfA,MAeA;AACA;AACAD,2BADA;AAEAC;AAFA;AAIA;AACA,OAtBA;AAuBA;AA3HA;AAhBA","names":["data","page","state","isHere","startTime","endTime","dataState","created","methods","loaddata","loadstate","getWorkTime","formatType","row","formatDate","hour","minute","second","changeState","num","username","count","time","worktime","message","type"],"sourceRoot":"src/views","sources":["EmployeDaKa.vue"],"sourcesContent":["<template>\n<div>\n  <el-row>\n    <el-col>\n      上班时间 {{startTime+\"---\"+endTime}}\n    </el-col>\n  </el-row>\n    <el-row>\n        <el-col :span='10' >员工状态 {{state}} </el-col>\n        <el-col :span=\"12\" style=\"margin-bottom: 10px\">\n            <el-button type=\"primary\" @click=\"changeState(0)\" :disabled='isHere'>上班打卡</el-button>\n            <el-button type=\"success\" @click=\"changeState(1)\" :disabled='!isHere'>下班打卡</el-button>\n            <el-button type=\"danger\" @click=\"changeState(2)\" :disabled='!isHere'>外出打卡</el-button>\n            <el-button type=\"warning\" @click=\"changeState(3)\" :disabled='isHere'>返回打卡</el-button>\n        </el-col>\n    </el-row>\n    <el-table\n            :data=\"page\"\n            border\n            style=\"width: 100%\"\n            :default-sort = \"{prop: 'time', order: 'descending'}\"\n            >\n        <el-table-column\n            prop=\"name\"\n            label=\"用户名\"\n        >\n        </el-table-column>\n        <el-table-column\n            prop=\"account\"\n            label=\"工号\">\n        </el-table-column>\n        \n        <el-table-column\n            prop=\"time\"\n            label=\"打卡时间\"\n            sortable\n            :formatter=\"formatDate\"\n            >\n        </el-table-column>\n        <el-table-column\n            prop=\"type\"\n            label=\"打卡类型\"\n            :formatter=\"formatType\"\n            >\n        </el-table-column>\n    </el-table>\n</div>\n    \n   \n</template>\n\n<style >\n</style>\n\n<script>\nexport default {\n     data(){\n          return{\n            page:[],\n            state:' ',\n            isHere:false,\n            startTime:'',\n            endTime:'',\n            dataState:''\n          }\n      },\n      created(){\n        this.loaddata();\n        this.loadstate();\n        this.getWorkTime();\n      },\n      methods:{\n        loaddata(){\n            var account = window.sessionStorage.getItem('account');\n            this.$http.get('/queryRecordsByActOrType?account='+account).then(res => {\n                this.page = res.data;\n            });\n        },\n        loadstate(){\n            var empId = window.sessionStorage.getItem('empId');\n            this.$http.get('/queryEmpStateById/'+empId).then(res => {\n                if (res.data==0){\n                    this.state = '下班';\n                    this.isHere = false;\n                }else if (res.data==1){\n                    this.state = '在班';\n                    this.isHere = true;\n                }else if (res.data==2){\n                    this.state = '外出';\n                    this.isHere = false;\n                }else if (res.data==3){\n                    this.state = '假期';\n                    this.isHere = false;\n                }else if (res.data==4){\n                    this.state = '请假';\n                    this.isHere = false;\n                }\n            });\n        },\n        getWorkTime(){\n          this.$http.get(\"/time/getWorkTime\").then(res => {\n            this.startTime=res.data[0].starttime;\n            this.endTime=res.data[0].endtime;\n          })\n        },\n        formatType(row){\n            if (row.type == 0) {\n                return '上班打卡';\n            } else if (row.type == 1) {\n                return '下班打卡';\n            } else if (row.type == 2) {\n                return '外出打卡';\n            } else if (row.type == 3) {\n                return '返回打卡';\n            }\n        },\n        formatDate(row){\n            var date = new Date(row.time);\n            var year = date.getFullYear();\n            var month = date.getMonth()+1;\n            var day = date.getDate();\n            var hour = date.getHours();\n            hour = hour < 10 ? \"0\" + hour : hour;\n            var minute = date.getMinutes();\n            minute = minute < 10 ? \"0\" + minute : minute;\n            var second = date.getSeconds();\n            second = second < 10 ? \"0\" + second : second;\n            return year+'-'+month+'-'+day+' '+hour+':'+minute+':'+second;\n        },\n         changeState(num){\n           var hour1=parseInt(this.startTime.split(':')[0]);\n           var mimute1=parseInt(this.startTime.split(':')[1]);\n           var hour2=parseInt(this.endTime.split(':')[0]);\n           var mimute2=parseInt(this.endTime.split(':')[1]);\n           var date=new Date();\n           var y=date.getFullYear();\n           var m=date.getMonth();\n           var d=date.getDate();\n           var h=date.getHours();\n           var miu=date.getMinutes();\n           const time=y+'-'+m+'-'+d+'  '+h+':'+miu;\n           const worktime=this.startTime+'-'+this.endTime;\n           var hour=parseInt(date.getHours());\n           var minute=parseInt(date.getMinutes());\n           if(num===0){\n             if((hour*60+minute)>(hour1*60+mimute1)){\n              this.dataState='迟到'\n             }\n             else {\n               this.dataState='正常'\n             }\n           }\n           else if(num===1){\n             if((hour*60+minute)>(hour2*60+mimute2+60)){\n               this.dataState='加班'\n             }\n             else if((hour*60+minute)<(hour2*60+mimute2-60)){\n               this.dataState='早退'\n             }\n             else {\n               this.dataState='正常'\n             }\n           }\n            this.$http.post('/dakaState/addDakaState',{\n                username: this.page[0].name,\n                count: window.sessionStorage.getItem('account'),\n              time:time,\n              state:this.dataState,\n              worktime:worktime\n            })\n            var empId = window.sessionStorage.getItem('empId');\n            this.$http.post('/checkInOrOut/'+empId+'/'+num).then(res => {\n                if (res.data) {\n                    this.$message({\n                        message: '操作成功',\n                        type: 'success'\n                    });\n                    this.loaddata();\n                    this.loadstate();\n                    if(num == 0){\n                        this.isHere = true;}\n                    else if(num == 1){\n                        this.isHere = false;}\n                    else if(num == 2){\n                        this.isHere = false;}\n                    else if(num == 3){\n                        this.isHere = true;}\n                } else {\n                    this.$message({\n                        message: '操作失败',\n                        type: 'error'\n                    });\n                }\n            });\n        },\n\n      }\n }\n  </script>\n  "]},"metadata":{},"sourceType":"module"}